<!DOCTYPE html>
<html>
  <head>

    <title>Fractal Viewer</title>
    <meta charset="UTF-8">

    <!-- Responsible for keeping canvas aligned on page -->
    <link rel="stylesheet" href="style.css">

  </head>
  <body>

    <!-- Main area to draw fractals -->
    <canvas id="display"></canvas>

    <!-- Pulls in the rendering engine -->
    <script src="engine.js"></script>
    <script src="driver.js"></script>

    <!-- Connects user interactions to various functions of the Driver -->
    <script>

    /*
     * Functions for menu creation
     */

    function openMenu(x, y)
    {
         let box = document.createElement('div');

         box.className = 'menu';
         box.style.left = x + 'px';
         box.style.top = y + 'px';

         box.appendChild(addMenuItem('Fractal'));
         box.appendChild(addMenuItem('Quality'));
         box.appendChild(addMenuItem('Color Scheme'));

         document.body.appendChild(box);
    }

    function addMenuItem(text)
    {
        let textNode = document.createTextNode(text);
        let menuItem = document.createElement('div');
        menuItem.appendChild(textNode);
        return menuItem;
    }

    /*
     * Set up Engine and Driver and connect
     * events to various Driver functions
     */

    Engine().then(function (engine) {

        const display = document.getElementById('display');
        const driver = new Driver(display, engine);

        // Refresh whenever the window is resized
        window.onresize = function () {
            driver.update();
        };

        // Capture click events
        window.onclick = function (mouseEvent) {
            mouseEvent.preventDefault();
            if (mouseEvent.x < 100 || mouseEvent.x > (display.width - 100) ||
                mouseEvent.y < 100 || mouseEvent.y > (display.height - 100)) {
                // Clicking near the border means zoom out
                driver.zoomOut();
            } else {
                // Otherwise, zoom in on the clicked point
                driver.zoomIn(mouseEvent.x, mouseEvent.y);
            }
        };

        window.oncontextmenu = function (mouseEvent) {
            mouseEvent.preventDefault();
            openMenu(mouseEvent.x, mouseEvent.y);
        }

        // Once everything is loaded, render the initial view
        driver.update();
    });

    </script>

  </body>
</html>
